{
  email {$ACME_EMAIL}
}

# Root domain (optional)
{$ROOT_DOMAIN} {
  encode gzip

  @api path /api* /api/*
  handle @api {
    reverse_proxy backend:{$BACKEND_PORT}
  }

  handle {
    reverse_proxy frontend:{$FRONTEND_PORT}
  }
}

# Force non-www for root domain
www.{$ROOT_DOMAIN} {
  redir https://{$ROOT_DOMAIN}{uri}
}

# Panel subdomain (primary)
{$PANEL_DOMAIN} {
  encode gzip

  @api path /api* /api/*
  handle @api {
    reverse_proxy backend:{$BACKEND_PORT}
  }

  handle {
    reverse_proxy frontend:{$FRONTEND_PORT}
  }
}

# Force non-www for panel subdomain
www.{$PANEL_DOMAIN} {
  redir https://{$PANEL_DOMAIN}{uri}
}